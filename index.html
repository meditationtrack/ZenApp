<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>Registro de Meditaci√≥n</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="meditateicon.png">
    <link rel="stylesheet" href="styles.css?v=9">
</head>
<body>
    <!-- Firebase Authentication Modal -->
    <div id="auth-modal" class="modal" style="display: none;">
        <div class="modal-content auth-content">
            <h2>Registro de Meditaci√≥n</h2>
            <p>Inicia sesi√≥n para sincronizar tus datos de meditaci√≥n en todos los dispositivos</p>
            <div id="auth-forms">
                <div id="signin-form" class="auth-form">
                    <input type="email" id="signin-email" placeholder="Correo Electr√≥nico" required>
                    <input type="password" id="signin-password" placeholder="Contrase√±a" required>
                    <button id="signin-btn" class="btn-primary">Iniciar Sesi√≥n</button>
                    <p class="auth-switch">¬øNo tienes una cuenta? <a href="#" id="show-signup">Registrarse</a></p>
                </div>
                <div id="signup-form" class="auth-form" style="display: none;">
                    <input type="text" id="signup-name" placeholder="Nombre" required>
                    <input type="email" id="signup-email" placeholder="Correo Electr√≥nico" required>
                    <input type="password" id="signup-password" placeholder="Contrase√±a (m√≠nimo 6 caracteres)" required>
                    <button id="signup-btn" class="btn-primary">Crear Cuenta</button>
                    <p class="auth-switch">¬øYa tienes una cuenta? <a href="#" id="show-signin">Iniciar sesi√≥n</a></p>
                </div>
            </div>
            <div id="auth-error" class="auth-error" style="display: none;"></div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span class="toast-icon">‚ú®</span>
        <span class="toast-message">¬°Sesi√≥n guardada exitosamente!</span>
    </div>

    <div class="container">
        <header>
            <p id="welcome-name" class="welcome-message" style="display: none;"></p>
            <h1 id="app-title">Registro de Meditaci√≥n</h1>
            <button id="settings-btn" class="settings-btn" title="Settings">‚ãÆ</button>
            <nav>
                <button class="nav-btn active" data-view="dashboard">üåø Panel</button>
                <button class="nav-btn" data-view="timer">üßò Meditar</button>
                <button class="nav-btn" data-view="log">‚úçÔ∏è Registrar</button>
                <button class="nav-btn" data-view="stats">‚òØÔ∏è Stats</button>
            </nav>
        </header>

        <!-- Dashboard View -->
        <section id="dashboard-view" class="view active">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="month-days-count">0</div>
                    <div class="stat-label">d√≠as este mes</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="month-time">0</div>
                    <div class="stat-label" id="month-label">en Enero</div>
                </div>
            </div>

            <div class="calendar-section">
                <div class="calendar-controls">
                    <button id="prev-month">‚Äπ</button>
                    <h3 id="calendar-title">Enero 2026</h3>
                    <button id="next-month">‚Ä∫</button>
                </div>
                <div class="calendar" id="calendar"></div>
            </div>
        </section>

        <!-- Daily Session View -->
        <section id="daily-view" class="view">
            <div class="daily-session-container">
                <!-- Session Mode: Before/During Meditation -->
                <div id="daily-session-mode" class="daily-mode">
                    <div class="daily-timer-wrapper">
                        <svg class="daily-timer-circle" viewBox="0 0 200 200">
                            <defs>
                                <linearGradient id="breathGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#a8c99a"/>
                                    <stop offset="50%" style="stop-color:#8ab842"/>
                                    <stop offset="100%" style="stop-color:#6b9b3a"/>
                                </linearGradient>
                            </defs>
                            <circle class="daily-circle-bg" cx="100" cy="100" r="85"></circle>
                            <circle class="daily-circle-progress" cx="100" cy="100" r="85" id="daily-progress-circle"></circle>
                            <circle class="daily-circle-glow" cx="100" cy="100" r="75" id="daily-glow-circle"></circle>
                        </svg>
                        <div class="daily-timer-content">
                            <div class="daily-timer-display" id="daily-timer-display">10:00</div>
                            <div class="daily-timer-label" id="daily-timer-label">Sesi√≥n diaria de 10 minutos</div>
                        </div>
                    </div>
                    <div class="daily-buttons">
                        <button id="start-daily-session" class="btn-primary daily-start-btn">
                            üßò Iniciar Sesi√≥n
                        </button>
                        <button id="stop-daily-session" class="btn-secondary daily-stop-btn" style="display: none;">
                            ‚èπÔ∏è Detener
                        </button>
                    </div>
                    <div class="daily-options">
                        <button id="daily-music-toggle" class="daily-option-btn" title="M√∫sica">
                            üéµ M√∫sica: On
                        </button>
                        <button id="daily-vibration-toggle" class="daily-option-btn" title="Vibraci√≥n" style="display: none;">
                            üì≥ Vibraci√≥n: On
                        </button>
                    </div>
                    <p class="daily-hint" id="daily-hint">Encuentra un lugar tranquilo y ponte c√≥modo</p>
                </div>

                <!-- Log Mode: After Meditation -->
                <div id="daily-log-mode" class="daily-mode" style="display: none;">
                    <div class="daily-complete-header">
                        <div class="daily-complete-icon">‚ú®</div>
                        <h3>¬°Sesi√≥n Completada!</h3>
                        <p class="daily-complete-stats">10 minutos de meditaci√≥n</p>
                    </div>
                    <form id="daily-session-form" class="daily-log-form">
                        <div class="form-group">
                            <label for="daily-date">üìÖ Fecha</label>
                            <input type="date" id="daily-date" required>
                        </div>
                        <div class="form-group">
                            <label for="daily-location">üìç Ubicaci√≥n (opcional)</label>
                            <input type="text" id="daily-location" placeholder="Casa, Oficina, Parque...">
                        </div>
                        <div class="form-group">
                            <label for="daily-notes">üìù Reflexiones/Notas (opcional)</label>
                            <textarea id="daily-notes" placeholder="¬øC√≥mo te sientes despu√©s de la sesi√≥n?" rows="4"></textarea>
                        </div>
                        <div class="daily-log-buttons">
                            <button type="submit" class="btn-primary">üíæ Guardar</button>
                            <button type="button" id="skip-daily-log" class="btn-secondary">Omitir</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Log Session View -->
        <section id="log-view" class="view">
            <div class="log-entry">
                <h3>‚úçÔ∏è Registrar Sesi√≥n de Meditaci√≥n</h3>
                <form id="meditation-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="duration">‚è±Ô∏è Minutos</label>
                            <input type="number" id="duration" min="1" max="1800" required placeholder="20">
                        </div>
                        <div class="form-group">
                            <label for="date">üìÖ Fecha</label>
                            <input type="date" id="date" required>
                        </div>
                        <div class="form-group">
                            <label for="location">üìç Ubicaci√≥n</label>
                            <input type="text" id="location" placeholder="Casa">
                        </div>
                    </div>
                    <div class="form-group">
                        <textarea id="notes" placeholder="üìù Reflexiones/Notas (opcional)" rows="4"></textarea>
                    </div>
                    <button type="submit" class="btn-primary">Registrar Sesi√≥n</button>
                </form>
            </div>

            <div class="session-history">
                <h3>üìö Sesiones Recientes</h3>
                <div id="history-list"></div>
            </div>
        </section>

        <!-- Meditation Timer View -->
        <section id="timer-view" class="view">
            <div class="daily-session-container">
                <!-- Timer Mode: Before/During Meditation -->
                <div id="timer-session-mode" class="daily-mode">
                    <div class="daily-timer-wrapper">
                        <canvas id="timer-particle-canvas" class="particle-canvas"></canvas>
                        <svg class="daily-timer-circle" viewBox="0 0 200 200">
                            <defs>
                                <linearGradient id="breathGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#a8c99a"/>
                                    <stop offset="50%" style="stop-color:#8ab842"/>
                                    <stop offset="100%" style="stop-color:#6b9b3a"/>
                                </linearGradient>
                            </defs>
                            <circle class="daily-circle-bg" cx="100" cy="100" r="85"></circle>
                            <circle class="daily-circle-progress" cx="100" cy="100" r="85" id="timer-progress-circle"></circle>
                            <circle class="daily-circle-glow" cx="100" cy="100" r="75" id="timer-glow-circle"></circle>
                        </svg>
                        <div class="daily-timer-content">
                            <input type="text" class="timer-editable-display" id="timer-display" value="10:00" maxlength="5" />
                            <div class="daily-timer-label" id="timer-label">Toca para editar</div>
                        </div>
                    </div>
                    <div class="daily-buttons">
                        <button id="start-timer" class="btn-primary daily-start-btn">
                            üßò Iniciar Sesi√≥n
                        </button>
                        <button id="stop-timer" class="btn-secondary daily-stop-btn" style="display: none;">
                            ‚èπÔ∏è Detener
                        </button>
                    </div>
                    <div class="daily-options">
                        <button id="timer-music-toggle" class="daily-option-btn" title="M√∫sica">
                            üéµ M√∫sica: On
                        </button>
                        <button id="timer-customize-btn" class="daily-option-btn" title="Personalizar">
                            ‚öôÔ∏è Personalizar
                        </button>
                        <button id="timer-vibration-toggle" class="daily-option-btn" title="Vibraci√≥n" style="display: none;">
                            üì≥ Vibraci√≥n: On
                        </button>
                    </div>
                    <p class="daily-hint" id="timer-hint">Encuentra un lugar tranquilo y ponte c√≥modo</p>
                </div>

                <!-- Timer Customization Panel -->
                <div id="timer-customize-panel" class="customize-panel" style="display: none;">
                    <div class="customize-header">
                        <h3>‚öôÔ∏è Personalizar Timer</h3>
                        <button id="close-customize-panel" class="close-btn">‚úï</button>
                    </div>
                    
                    <div class="customize-section">
                        <label class="customize-label">üé® Animaci√≥n</label>
                        <div class="customize-options">
                            <button class="customize-option-btn active" data-animation="none">
                                <span class="option-icon">‚óã</span>
                                <span class="option-text">Simple</span>
                            </button>
                            <button class="customize-option-btn" data-animation="ripple">
                                <span class="option-icon">üåä</span>
                                <span class="option-text">Ondas Zen</span>
                            </button>
                            <button class="customize-option-btn" data-animation="candle">
                                <span class="option-icon">üïØÔ∏è</span>
                                <span class="option-text">Velita</span>
                            </button>
                            <button class="customize-option-btn" data-animation="cosmos">
                                <span class="option-icon">‚ú®</span>
                                <span class="option-text">Cosmos</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="customize-section">
                        <label class="customize-label">üéµ M√∫sica de fondo</label>
                        <div class="customize-options">
                            <button class="customize-option-btn active" data-music="ambient">
                                <span class="option-icon">‚ú®</span>
                                <span class="option-text">Ambiente</span>
                            </button>
                            <button class="customize-option-btn" data-music="naturaleza">
                                <span class="option-icon">üê¶</span>
                                <span class="option-text">Naturaleza</span>
                            </button>
                            <button class="customize-option-btn" data-music="mar">
                                <span class="option-icon">üåä</span>
                                <span class="option-text">Mar</span>
                            </button>
                        </div>
                        <button id="preview-music-btn" class="preview-btn">‚ñ∂Ô∏è Escuchar</button>
                    </div>
                </div>

                <!-- Log Mode: After Meditation -->
                <div id="timer-log-mode" class="daily-mode" style="display: none;">
                    <div class="daily-complete-header">
                        <div class="daily-complete-icon">‚ú®</div>
                        <h3>¬°Sesi√≥n Completada!</h3>
                        <p class="daily-complete-stats" id="timer-complete-stats">Meditaci√≥n completada</p>
                    </div>
                    <form id="timer-session-form" class="daily-log-form">
                        <div class="form-group">
                            <label for="timer-log-date">üìÖ Fecha</label>
                            <input type="date" id="timer-log-date" required>
                        </div>
                        <div class="form-group">
                            <label for="timer-log-location">üìç Ubicaci√≥n (opcional)</label>
                            <input type="text" id="timer-log-location" placeholder="Casa, Oficina, Parque...">
                        </div>
                        <div class="form-group">
                            <label for="timer-log-notes">üìù Reflexiones/Notas (opcional)</label>
                            <textarea id="timer-log-notes" placeholder="¬øC√≥mo te sientes despu√©s de la sesi√≥n?" rows="4"></textarea>
                        </div>
                        <div class="daily-log-buttons">
                            <button type="submit" class="btn-primary">üíæ Guardar</button>
                            <button type="button" id="skip-timer-log" class="btn-secondary">Omitir</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Stats View -->
        <section id="stats-view" class="view">
            <div class="stats-overview">
                <h3>Resumen 2026</h3>
                <div class="global-stats-grid">
                    <div class="global-stat-box">
                        <div class="global-stat-value" id="year-total-time">0</div>
                        <div class="global-stat-label">tiempo total</div>
                    </div>
                    <div class="global-stat-box">
                        <div class="global-stat-value" id="year-total-sessions">0</div>
                        <div class="global-stat-label">sesiones</div>
                    </div>
                    <div class="global-stat-box">
                        <div class="global-stat-value" id="year-avg-duration">0</div>
                        <div class="global-stat-label">duraci√≥n promedio</div>
                    </div>
                    <div class="global-stat-box">
                        <div class="global-stat-value" id="year-days-count">0</div>
                        <div class="global-stat-label">d√≠as meditados</div>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Tiempo Total por Mes</h3>
                <canvas id="monthlyMinutesChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h3>D√≠as Meditados por Mes</h3>
                <canvas id="monthlyDaysChart"></canvas>
            </div>
        </section>
    </div>

    <!-- Session Detail Modal -->
    <div id="session-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h3 id="modal-title">üìã Detalles de la Sesi√≥n</h3>
            <div id="modal-body">
                <div class="modal-field">
                    <label>‚è±Ô∏è Duraci√≥n</label>
                    <input type="number" id="modal-duration" min="1">
                    <span class="modal-text" id="modal-duration-text"></span>
                </div>
                <div class="modal-field">
                    <label>üìÖ Fecha</label>
                    <input type="date" id="modal-date">
                    <span class="modal-text" id="modal-date-text"></span>
                </div>
                <div class="modal-field">
                    <label>üìç Ubicaci√≥n</label>
                    <input type="text" id="modal-location">
                    <span class="modal-text" id="modal-location-text"></span>
                </div>
                <div class="modal-field">
                    <label>üìù Reflexiones/Notas</label>
                    <input type="text" id="modal-notes">
                    <span class="modal-text" id="modal-notes-text"></span>
                </div>
            </div>
            <div class="modal-actions">
                <button id="modal-edit" class="btn-primary">Editar</button>
                <button id="modal-save" class="btn-primary" style="display: none;">Guardar</button>
                <button id="modal-cancel" class="btn-secondary" style="display: none;">Cancelar</button>
                <button id="modal-delete" class="btn-delete">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Day Sessions Modal -->
    <div id="day-sessions-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close day-sessions-close">&times;</span>
            <h3 id="day-sessions-title">üìã Sesiones</h3>
            <div id="day-sessions-list"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close settings-close">&times;</span>
            <h3>Configuraci√≥n</h3>
            <div class="settings-section" id="name-section" style="display: none;">
                <h4>Tu Nombre</h4>
                <input type="text" id="settings-name" placeholder="Nombre" class="settings-input">
            </div>
            <div class="settings-section">
                <h4>Icono de Meditaci√≥n</h4>
                <p class="settings-description">Elige tu icono preferido para los d√≠as del calendario</p>
                <div class="emoji-grid">
                    <button class="emoji-option" data-emoji="üßò" title="Person meditating">üßò</button>
                    <button class="emoji-option" data-emoji="üïâÔ∏è" title="Om symbol">üïâÔ∏è</button>
                    <button class="emoji-option" data-emoji="üôè" title="Praying hands">üôè</button>
                    <button class="emoji-option" data-emoji="‚òÆÔ∏è" title="Peace symbol">‚òÆÔ∏è</button>
                    <button class="emoji-option" data-emoji="üå∫" title="Hibiscus flower">üå∫</button>
                    <button class="emoji-option" data-emoji="‚ú®" title="Sparkles">‚ú®</button>
                    <button class="emoji-option" data-emoji="üå∏" title="Cherry blossom">üå∏</button>
                    <button class="emoji-option" data-emoji="‚òØÔ∏è" title="Yin yang">‚òØÔ∏è</button>
                </div>
            </div>
            <button id="signout-btn" class="btn-secondary" style="display: none; margin-top: 1.5rem; width: 100%;">Cerrar Sesi√≥n</button>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content confirm-content">
            <h3>¬øEliminar Sesi√≥n?</h3>
            <p>Esta acci√≥n no se puede deshacer.</p>
            <div class="modal-actions">
                <button id="confirm-yes" class="btn-delete">Eliminar</button>
                <button id="confirm-no" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <audio id="bell-sound" preload="auto"></audio>
    
    <!-- Fullscreen Candle Mode Overlay -->
    <div id="candle-fullscreen-overlay" class="candle-overlay" style="display: none;">
        <canvas id="candle-fullscreen-canvas"></canvas>
        <div class="candle-timer-content">
            <svg class="candle-timer-circle" viewBox="0 0 200 200">
                <circle class="candle-circle-bg" cx="100" cy="100" r="85"></circle>
                <circle class="candle-circle-progress" cx="100" cy="100" r="85" id="candle-progress-circle"></circle>
            </svg>
            <div class="candle-timer-display" id="candle-timer-display">10:00</div>
        </div>
        <div class="candle-phrase" id="candle-phrase"></div>
        <button class="candle-exit-btn" id="candle-exit-btn">‚úï</button>
    </div>
    
    <!-- Fullscreen Ripple/Ondas Zen Mode Overlay -->
    <div id="ripple-fullscreen-overlay" class="ripple-overlay" style="display: none;">
        <canvas id="ripple-fullscreen-canvas"></canvas>
        <div class="ripple-timer-content">
            <svg class="ripple-timer-circle" viewBox="0 0 200 200">
                <circle class="ripple-circle-bg" cx="100" cy="100" r="85"></circle>
                <circle class="ripple-circle-progress" cx="100" cy="100" r="85" id="ripple-progress-circle"></circle>
            </svg>
            <div class="ripple-timer-display" id="ripple-timer-display">10:00</div>
        </div>
        <div class="ripple-phrase" id="ripple-phrase"></div>
        <button class="ripple-exit-btn" id="ripple-exit-btn">‚úï</button>
    </div>
    
    <!-- Fullscreen Cosmos/Starfield Mode Overlay -->
    <div id="cosmos-fullscreen-overlay" class="cosmos-overlay" style="display: none;">
        <canvas id="cosmos-fullscreen-canvas"></canvas>
        <div class="cosmos-timer-content">
            <svg class="cosmos-timer-circle" viewBox="0 0 200 200">
                <circle class="cosmos-circle-bg" cx="100" cy="100" r="85"></circle>
                <circle class="cosmos-circle-progress" cx="100" cy="100" r="85" id="cosmos-progress-circle"></circle>
            </svg>
            <div class="cosmos-timer-display" id="cosmos-timer-display">10:00</div>
        </div>
        <div class="cosmos-phrase" id="cosmos-phrase"></div>
        <button class="cosmos-exit-btn" id="cosmos-exit-btn">‚úï</button>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    
    <!-- App Script -->
    <script src="app.js"></script>
</body>
</html>
